{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SIEM Event Record",
  "description": "SIEM event schema for AI Agent Governance Framework v2.0 with OCSF mapping support",
  "type": "object",
  "required": [
    "siem_event_id",
    "timestamp",
    "source",
    "payload",
    "control_id",
    "agent_id",
    "tier"
  ],
  "properties": {
    "siem_event_id": {
      "type": "string",
      "description": "Unique identifier, must match audit_id for correlation with audit-trail entries."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO-8601 timestamp of the event (UTC)."
    },
    "source": {
      "type": "string",
      "enum": ["audit-trail", "secrets-manager", "jira", "infra", "ci-cd", "agent-runtime", "other"],
      "description": "Origin of the event."
    },
    "control_id": {
      "type": "string",
      "description": "Governance control ID (e.g., SEC-001, MI-003, APP-001, G-02)",
      "pattern": "^(SEC|MI|APP|G|RI)-[0-9]{3}$"
    },
    "agent_id": {
      "type": "string",
      "description": "Agent identifier (e.g., security-agent, ops-agent-01)"
    },
    "tier": {
      "type": "integer",
      "minimum": 1,
      "maximum": 4,
      "description": "Agent tier (1=Observer, 2=Developer, 3=Operations, 4=Architect)"
    },
    "jira_reference": {
      "type": "object",
      "description": "Jira CR reference for approval correlation (required for Tier 3/4 events)",
      "properties": {
        "cr_id": {
          "type": "string",
          "description": "Jira Change Request ID",
          "pattern": "^CR-[0-9]{4}-[0-9]{4}$"
        },
        "approver_role": {
          "type": "string",
          "description": "Role of approver (e.g., Change Manager, Security Lead)"
        },
        "status": {
          "type": "string",
          "enum": ["Approved", "Pending", "Rejected"],
          "description": "Current status of CR at time of event"
        },
        "approved_at": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when CR was approved"
        }
      },
      "required": ["cr_id", "approver_role", "status"]
    },
    "payload": {
      "type": "object",
      "description": "Event-specific details (mirrors audit-trail inputs/outputs)."
    },
    "compliance_result": {
      "type": "string",
      "enum": ["pass", "fail", "warning"],
      "description": "Compliance evaluation result for this event."
    },
    "ocsf_mapping": {
      "type": "object",
      "description": "Open Cybersecurity Schema Framework (OCSF) mapping for normalization",
      "properties": {
        "category_uid": {
          "type": "integer",
          "description": "OCSF category UID (1=System, 2=Findings, 3=IAM, 4=Network, 5=Discovery, 6=Application)",
          "minimum": 1,
          "maximum": 6
        },
        "class_uid": {
          "type": "integer",
          "description": "OCSF class UID within category (e.g., 3001=Authentication, 3005=Account Change)"
        },
        "severity_id": {
          "type": "integer",
          "description": "OCSF severity (1=Info, 2=Low, 3=Medium, 4=High, 5=Critical)",
          "minimum": 1,
          "maximum": 5
        },
        "activity_id": {
          "type": "integer",
          "description": "OCSF activity ID for specific action type"
        }
      },
      "required": ["category_uid", "class_uid", "severity_id"]
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata for event context",
      "properties": {
        "environment": {
          "type": "string",
          "enum": ["dev", "staging", "prod"],
          "description": "Deployment environment"
        },
        "workflow_id": {
          "type": "string",
          "description": "CI/CD workflow run ID for traceability"
        },
        "correlation_id": {
          "type": "string",
          "description": "Correlation ID for distributed tracing"
        }
      }
    }
  }
}
