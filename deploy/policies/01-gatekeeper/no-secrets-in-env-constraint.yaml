---
# Gatekeeper Constraint: Apply Secrets Prevention Policy
#
# This constraint applies the K8sNoSecretsInEnv template to all pods
# in AI agent namespaces to prevent hardcoded secrets
#
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: K8sNoSecretsInEnv
metadata:
  name: ai-agent-no-secrets-in-env
  annotations:
    description: "Prevent hardcoded secrets in AI agent environment variables"
    framework.ai/control-id: "MI-001, MI-003"
    nist.gov/control-id: "IA-5(7)"
spec:
  # IMPORTANT: Start in 'dryrun' mode to audit violations without blocking
  # Change to 'deny' after validating existing deployments
  enforcementAction: dryrun  # Options: deny, dryrun, warn
  
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["Pod"]
      - apiGroups: ["apps"]
        kinds: ["Deployment", "StatefulSet", "DaemonSet"]
    namespaceSelector:
      matchExpressions:
      - key: framework
        operator: In
        values: ["ai-governance"]
  
  parameters:
    # Containers exempt from secret scanning (use sparingly!)
    # Example: init containers that only set up directories
    exemptContainers: []
    # - "framework-init"
